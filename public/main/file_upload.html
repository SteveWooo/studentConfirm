<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="../library/vuetify.min.css" rel="stylesheet">

  <script src="../library/vue.min.js"></script>
  <script src="../library/jquery.min.js"></script>
  <script src="../library/vuetify.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
    <div id="app">
    <v-app>
        <v-main>
            <v-container>
                <div>
                    hello
                    <input type="file" id="file">
                </div>
            </v-container>
        </v-main>
    </v-app>
    </div>

    <script src="../library/xlsx.core.min.js"></script>
    <script src="../library/crypto-js.js"></script>
    <script>
        var config = {
            idNumColName : "身份证",
            titleLine : 1,

            password : "1234123412341234",
            iv : "12345678"
        }
        // AES加密
        function encryptoAES(data, key, iv) {
            var tempKey = CryptoJS.enc.Utf8.parse(key);
            var tempIv = CryptoJS.enc.Utf8.parse(iv);
            var secretData = CryptoJS.AES.encrypt(data, tempKey, {
                iv: tempIv, 
                mode: CryptoJS.mode.CBC, 
                padding: CryptoJS.pad.Pkcs7
            });
            // return secretData.toString();
            return secretData.toString();
        }

        // AES解密
        function decryptoAES(secretData, key, iv) {
            var tempKey = CryptoJS.enc.Utf8.parse(key);
            var tempIv = CryptoJS.enc.Utf8.parse(iv);
            var originData = CryptoJS.AES.decrypt(secretData, tempKey, {
                iv: tempIv, 
                mode: CryptoJS.mode.CBC, 
                padding: CryptoJS.pad.Pkcs7
            });
            return originData.toString(CryptoJS.enc.Utf8);
        }
        
        $("#file").change(function(e) {
            var file = e.target.files;
            var fileReader = new FileReader();
            var data, workbook;
            fileReader.onload = function(ev) {
                try {
                    data = ev.target.result;
                    workbook = XLSX.read(data, {
                        type : 'binary'
                    })
                }catch(e) {
                    console.log("file type error");
                }

                // 记录整个表格的加密信息。
                var postData = {};

                var sheet = workbook.Sheets["Sheet1"];
                var sheetJson = XLSX.utils.sheet_to_json(sheet);
                for (var i=config.titleLine-1;i<sheetJson.length;i++) {
                    var idNum = sheetJson[i][config.idNumColName];
                    // console.log(idNum);
                    var dataStr = JSON.stringify(sheetJson[i]);
                    // console.log(dataStr)
                    var secretData = encryptoAES(dataStr, config.password, config.iv);
                    // console.log(secretData);
                    // var originData = decryptoAES(secretData, config.password, config.iv); // 解密获取原字符串的方式
                    // console.log(originData);

                    postData[idNum] = secretData;
                }

                console.log(postData);
            }
            fileReader.readAsBinaryString(file[0]);
        })
  </script>
</body>
</html>